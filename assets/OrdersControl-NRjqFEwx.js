import{a as f}from"./axios-L6U4YIEh.js";import{M as D}from"./bootstrap.esm-TTjMTX3M.js";import{_ as y,o as l,c as s,d as e,t as p,F as m,e as h,f as _,v as b,j as x,b as g,a as $,r as P,n as w,k as C,g as k,i as U}from"./index-CpkCOYWf.js";const S={props:["order","update-paid"],data(){return{modal:null,tempOrder:{},isPaid:!1}},emits:["update-paid"],methods:{openModal(){this.modal.show()},closeModal(){this.modal.hide()}},mounted(){this.modal=new D(this.$refs.productModal)},watch:{order(){this.tempOrder=this.order}}},T={class:"modal fade",id:"productModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"productModal"},E={class:"modal-dialog modal-xl",role:"document"},L={class:"modal-content border-0"},I={class:"modal-header bg-dark text-white"},N={class:"modal-title",id:"exampleModalLabel"},R=e("button",{type:"button",class:"btn-close-white","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),B={class:"modal-body"},q={class:"row"},A={class:"mb-3 col-md-4"},F=e("label",{for:"product",class:"form-label"},"Product",-1),z=["onUpdate:modelValue"],H={class:"mb-3 col-md-4"},J=e("label",{for:"price",class:"form-label"},"Each Price",-1),Q=["onUpdate:modelValue"],j={class:"mb-3 col-md-4"},W=e("label",{for:"qty",class:"form-label"},"Product Quantity",-1),Y=["onUpdate:modelValue"],G=e("hr",null,null,-1),K={class:"row"},X={class:"col"},Z=e("label",{for:"total",class:"form-label"},"Total",-1),ee={class:"col"},te={class:"form-check"},oe=e("label",{class:"form-check-label",for:"is_paid"},"Is paid",-1),de={class:"modal-footer"},re=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function le(d,o,n,c,t,u){return l(),s("div",T,[e("div",E,[e("div",L,[e("div",I,[e("h5",N,[e("span",null,"Order Detail '"+p(t.tempOrder.id)+"'",1)]),R]),e("div",B,[e("div",q,[e("div",A,[F,(l(!0),s(m,null,h(t.tempOrder.products,(i,a)=>(l(),s("div",{key:a},[_(e("input",{"onUpdate:modelValue":r=>t.tempOrder.products[a].product.title=r,type:"text",placeholder:"Product Title"},null,8,z),[[b,t.tempOrder.products[a].product.title]])]))),128))]),e("div",H,[J,(l(!0),s(m,null,h(t.tempOrder.products,(i,a)=>(l(),s("div",{key:a},[_(e("input",{"onUpdate:modelValue":r=>t.tempOrder.products[a].product.price=r,type:"text",placeholder:"Product price"},null,8,Q),[[b,t.tempOrder.products[a].product.price,void 0,{number:!0}]])]))),128))]),e("div",j,[W,(l(!0),s(m,null,h(t.tempOrder.products,(i,a)=>(l(),s("div",{key:a},[_(e("input",{"onUpdate:modelValue":r=>t.tempOrder.products[a].qty=r,type:"text",placeholder:"Product Quantity"},null,8,Y),[[b,t.tempOrder.products[a].qty,void 0,{number:!0}]])]))),128))])]),G,e("div",K,[e("div",X,[Z,_(e("input",{id:"total","onUpdate:modelValue":o[0]||(o[0]=i=>t.tempOrder.total=i),type:"text",min:"0",class:"form-control"},null,512),[[b,t.tempOrder.total,void 0,{number:!0}]])]),e("div",ee,[e("div",te,[_(e("input",{id:"is_paid","onUpdate:modelValue":o[1]||(o[1]=i=>t.tempOrder.is_paid=i),class:"form-check-input",type:"checkbox","true-value":1,"false-value":0},null,512),[[x,t.tempOrder.is_paid]]),oe])])]),e("div",de,[re,e("button",{type:"button",class:"btn btn-primary",onClick:o[2]||(o[2]=i=>d.$emit("update-paid",t.tempOrder))}," 修改付款狀態 ")])])])])],512)}const se=y(S,[["render",le]]),ae={props:["tempOrder","delOrder"],data(){return{delModalProduct:null}},methods:{openDelModal(){this.delModalProduct.show()},closeDelModal(){this.delModalProduct.hide()}},mounted(){this.delModalProduct=new D(this.$refs.delOrderModal)}},ne={id:"delOrderModal",ref:"delOrderModal",class:"modal fade",tabindex:"-1","aria-labelledby":"delOrderModalLabel","aria-hidden":"true"},ie={class:"modal-dialog"},ce={class:"modal-content border-0"},ue=e("div",{class:"modal-header bg-danger text-white"},[e("h5",{id:"delOrderModalLabel",class:"modal-title"},[e("span",null,"刪除訂單")]),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),pe={class:"modal-body"},me={class:"text-danger"},_e={class:"modal-footer"},he=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function be(d,o,n,c,t,u){return l(),s("div",ne,[e("div",ie,[e("div",ce,[ue,e("div",pe,[g(" 是否刪除 "),e("strong",me,p(n.tempOrder.id),1),g(" 訂單(刪除後將無法恢復)。 ")]),e("div",_e,[he,e("button",{type:"button",class:"btn btn-danger",onClick:o[0]||(o[0]=(...i)=>n.delOrder&&n.delOrder(...i))},"確認刪除")])])])],512)}const Oe=y(ae,[["render",be]]);var fe={VITE_URL:"https://vue3-course-api.hexschool.io/v2/",VITE_PATH:"han113",BASE_URL:"/vue-router/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:M,VITE_PATH:v}=fe,Me={name:"OrdersControlView",data(){return{orders:{},tempOrder:{},currentPage:1}},components:{OrderModal:se,DelOrderModal:Oe},methods:{getOrders(){const d=`${M}api/${v}/admin/orders`;f.get(d).then(o=>{console.log(o.data.orders),this.orders=o.data.orders}).catch(()=>{})},openModal(d){this.tempOrder={...d},this.$refs.orderModal.openModal()},openDelOrderModal(d){this.tempOrder={...d},this.$refs.delOrderModal.openDelModal()},updatePaid(d){const o=`${M}api/${v}/admin/order/${d.id}`,n={is_paid:d.is_paid===1},c=JSON.parse(JSON.stringify(n));console.log(c),f.put(o,{data:c}).then(()=>{this.getOrders(),this.$refs.orderModal.closeModal()}).catch(()=>{})},delOrder(d){const o=`${M}api/${v}/admin/order/${d.id}`;f.delete(o).then(n=>{this.$refs.delOrderModal.closeDelModal(),alert(n.data.message),this.getOrders()}).catch(()=>{})},formatDate(d){const o=new Date(d*1e3),n=o.getFullYear(),c=(o.getMonth()+1).toString().padStart(2,"0"),t=o.getDate().toString().padStart(2,"0");return`${n}-${c}-${t}`}},mounted(){this.getOrders()}},ve={class:"table mt-4"},ye=e("thead",null,[e("tr",null,[e("th",null,"購買時間"),e("th",null,"購買品項"),e("th",null,"Message"),e("th",null,"應付金額"),e("th",null,"是否付款"),e("th",null,"編輯")])],-1),ge={class:"btn-group"},$e=["onClick"],Pe=["onClick"];function ke(d,o,n,c,t,u){const i=P("Order-Modal"),a=P("Del-Order-Modal");return l(),s("div",null,[e("table",ve,[ye,e("tbody",null,[(l(!0),s(m,null,h(t.orders,r=>(l(),s(m,null,[t.orders.length?(l(),s("tr",{class:w({"text-secondary":!r.is_paid}),key:r+"123"},[e("td",null,p(u.formatDate(r.create_at)),1),e("td",null,[(l(!0),s(m,null,h(r.products,(O,V)=>(l(),s("span",{key:V},p(O.product.title)+" | ",1))),128))]),e("td",null,p(r.message),1),e("td",null,p(r.total),1),e("td",{style:C({color:r.is_paid?"green":"red"})},p(r.is_paid?"Paid":"Not Paid"),5),e("td",null,[e("div",ge,[e("button",{class:"btn btn-outline-primary btn-sm",type:"button",onClick:k(O=>u.openModal(r),["prevent"])}," 檢視 ",8,$e),e("button",{class:"btn btn-outline-danger btn-sm",type:"button",onClick:k(O=>u.openDelOrderModal(r),["prevent"])}," 刪除 ",8,Pe)])])],2)):U("",!0)],64))),256))]),$(i,{ref:"orderModal",order:t.tempOrder,onUpdatePaid:u.updatePaid},null,8,["order","onUpdatePaid"]),$(a,{"temp-order":t.tempOrder,"del-order":u.delOrder,ref:"delOrderModal"},null,8,["temp-order","del-order"])])])}const we=y(Me,[["render",ke]]);export{we as default};
